<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Flex.io Javascript SDK Test</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,700">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tachyons/4.8.1/tachyons.min.css" integrity="sha256-i0Y6JXo6ZVDJM7TUXTNTB2KKeO4TFQOfMTGgm9mW0II=" crossorigin="anonymous" />

  <style>
    html, body {
      font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-size: 100%;
    }

    pre {
      font-family: Consolas, monaco, monospace;
      font-size: 13px;
    }

    .flex-fill {
      flex: 1 1;
      min-width: 0; /* 1 */
      min-height: 0; /* 1 */
    }

    .darken-10:hover,
    .darken-10:focus {
      box-shadow: inset 9999px 9999px rgba(0,0,0,0.10)
    }

    .darken-10:active {
      box-shadow: inset 9999px 9999px rgba(0,0,0,0.20)
    }

  </style>
</head>

<body>
  <div id="app" class="pa3">
    <h1 class="mt0"></h1>
    <div class="flex flex-row mv3 w-100">
      <div class="w5 mr3">
        <button class="w-100 border-box no-select pointer ttu b ba f6 ph3 pv2 br1 white bg-blue b--blue darken-10" id="btn-list-connections">List connections</button>
      </div>
      <div class="flex-fill" id="connections"></div>
    </div>
    <div class="flex flex-row mv3 w-100">
      <div class="w5 mr3">
        <button class="w-100 border-box no-select pointer ttu b ba f6 ph3 pv2 br1 white bg-blue b--blue darken-10" id="btn-list-pipes">List pipes</button>
      </div>
      <div class="flex-fill" id="pipes"></div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="../dist/flexio.min.js"></script>
  <script>
    var $app = $('#app')

    Flexio.setup('crhxftrjzjdjcbfvdcqg')

    $app.find('h1').text('Flex.io Javascript SDK Version: ' + Flexio.version())

    function listConnections() {
      var $div = $('#connections')
      $div.empty().append('Loading...')

      var connections = Flexio.connections().load(function() {
        $div.empty()
        $div.append('<h2 class="mt0">Connection List</h2>')
        $div.append('<h4>List View</h4>')
        $div.append('<pre>' + connections.list({ format: 'list', keys: ['eid', 'ename', 'name', 'description'] }) + '</pre>')
        $div.append('<h4>JSON View</h4>')
        $div.append('<pre>' + JSON.stringify(connections.list({ keys: ['eid', 'ename', 'name', 'description'] }), null, 2) + '</pre>')
      }, function() {
        $div.append('<h2>Connection List</h2>')
        $div.append('<pre>There was an error requesting the connection list</pre>')
      })
    }

    function listPipes() {
      var $div = $('#pipes')
      $div.empty().append('Loading...')

      var pipes = Flexio.pipes().load(function() {
        $div.empty()
        $div.append('<h2 class="mt0">Pipe List</h2>')
        $div.append('<h4>List View</h4>')
        $div.append('<pre>' + pipes.list({ format: 'list' }) + '</pre>')
        $div.append('<h4>JSON View</h4>')
        $div.append('<pre>' + JSON.stringify(pipes.list(), null, 2) + '</pre>')
      }, function() {
        $div.append('<h2>Pipe List</h2>')
        $div.append('<pre>There was an error requesting the pipe list</pre>')
      })
    }

    $('#btn-list-connections').click(function() {
      listConnections()
    })

    $('#btn-list-pipes').click(function() {
      listPipes()
    })

/*
    var pipe = Flexio.pipe()
      .execute("\
def flexio_handler(input, output):\n\
    writer = output.create(name='Hello')\n\
    if 'message' in input.env:\n\
        writer.write(input.env['message'])\n\
    else:\n\
        writer.write('Hello, World!')")
      .email('dave@flex.io', 'Flex.io JS SDK Test', 'This is a test...', null, 'attachment')
      .run()

    $app.append('<pre>' + JSON.stringify(pipe.getJson(), null, 2) + '</pre>')

    var pipe = Flexio.pipe()
      .execute("\
def flexio_handler(input, output):\n\
    writer = output.create(name='Hello')\n\
    if 'message' in input.env:\n\
        writer.write(input.env['message'])\n\
    else:\n\
        writer.write('Hello, World!')")
      .email('dzwillia@gmail.com', 'Flex.io JS SDK Test', 'This is a test...', null, 'attachment')

    var pipe = Flexio.pipe()
      .execute('https://raw.githubusercontent.com/flexiodata/examples/master/functions/hello-world.py')
      .save()
      .run()

    var pipe = Flexio.pipe()
      .input('googledrive', 'dave-google-drive', ['/test_data/data_payment.csv'])
      .convert('delimited', 'table')
      .select('VEND_NAME', 'DUE_DATE')
      .limit(10)
      .convert('table', 'json')
      .output('dropbox', 'dave-dropbox', '/test_data')

    pipe.save({}, function() {
      $app.append('<h2>Pipe Content</h2>')
      $app.append('<pre>' + JSON.stringify(pipe.getJson(), null, 2) + '</pre>')
    })
    .run(function() {
      $app.append('<h2>Process Content</h2>')
      $app.append('<pre>' + JSON.stringify(pipe.getLastProcess(), null, 2) + '</pre>')
    })

    var pipe = Flexio.pipe()
      .load('my-pipe-alias', function() {
        $app.append('<h2>Pipe Content</h2>')
        $app.append('<pre>' + JSON.stringify(pipe.getJson(), null, 2) + '</pre>')
      })
      .run(function() {
        $app.append('<h2>Process Content</h2>')
        $app.append('<pre>' + JSON.stringify(pipe.getLastProcess(), null, 2) + '</pre>')
      })
*/
  </script>
</body>
</html>
