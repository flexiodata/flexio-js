<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Flex.io Javascript SDK Test</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,700">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tachyons/4.8.1/tachyons.min.css" integrity="sha256-i0Y6JXo6ZVDJM7TUXTNTB2KKeO4TFQOfMTGgm9mW0II=" crossorigin="anonymous" />

  <style>
    html, body {
      font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-size: 100%;
    }

    pre {
      font-family: Consolas, monaco, monospace;
      font-size: 13px;
      margin: 0;
    }

    a,
    a:visited,
    a:hover,
    a:active {
      color: #357edd;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .flex-fill {
      flex: 1 1;
      min-width: 0; /* 1 */
      min-height: 0; /* 1 */
    }

    .darken-10:hover,
    .darken-10:focus {
      box-shadow: inset 9999px 9999px rgba(0,0,0,0.10)
    }

    .darken-10:active {
      box-shadow: inset 9999px 9999px rgba(0,0,0,0.20)
    }

  </style>
</head>

<body>
  <div id="app" class="pa3 w-60 center">
    <h1 class="mt0 pb2 bb b--black-10"></h1>

    <h2>List Examples</h2>

    <div class="mv3">
      <div class="pa3 bg-near-white">
        <h4 class="mt0">List connections (Console)</h4>
        <pre>var connections = Flexio.connections().load(function() {
  connections.list({ format: 'list', keys: ['eid', 'ename', 'name', 'description'] })
})</pre>
        <button class="mt3 border-box no-select pointer ttu b ba f6 ph3 pv2 br1 white bg-blue b--blue darken-10" id="btn-list-connections-console">Run</button>
      </div>
      <div class="pa3" id="connections-console"></div>
    </div>

    <div class="mv3">
      <div class="pa3 bg-near-white">
        <h4 class="mt0">List connections (JSON)</h4>
        <pre>var connections = Flexio.connections().load(function() {
  connections.list({ format: 'json', keys: ['eid', 'ename', 'name', 'description'] })
})</pre>
        <button class="mt3 border-box no-select pointer ttu b ba f6 ph3 pv2 br1 white bg-blue b--blue darken-10" id="btn-list-connections-json">Run</button>
      </div>
      <div class="pa3" id="connections-json"></div>
    </div>

    <div class="mv3">
      <div class="pa3 bg-near-white">
        <h4 class="mt0">List pipes (Console)</h4>
        <pre>var pipes = Flexio.pipes().load(function() {
  pipes.list({ format: 'list', keys: ['eid', 'ename', 'name', 'description'] })
})</pre>
        <button class="mt3 border-box no-select pointer ttu b ba f6 ph3 pv2 br1 white bg-blue b--blue darken-10" id="btn-list-pipes-console">Run</button>
      </div>
      <div class="pa3" id="pipes-console"></div>
    </div>

    <div class="mv3">
      <div class="pa3 bg-near-white">
        <h4 class="mt0">List pipes (JSON)</h4>
        <pre>var pipes = Flexio.pipes().load(function() {
  pipes.list({ format: 'json', keys: ['eid', 'ename', 'name', 'description'] })
})</pre>
        <button class="mt3 border-box no-select pointer ttu b ba f6 ph3 pv2 br1 white bg-blue b--blue darken-10" id="btn-list-pipes-json">Run</button>
      </div>
      <div class="pa3" id="pipes-json"></div>
    </div>

    <h2>Pipe Examples</h2>

    <div class="mv3">
      <div class="pa3 bg-near-white">
        <h4 class="mt0">Move a file from Google Drive to Dropbox (with modifications)</h4>
        <pre>Flexio.pipe()
  .input('googledrive', 'fxtest103-google-drive', ['/test_data/data_payment.csv'])
  .convert('delimited', 'table')
  .select('VEND_NAME', 'DUE_DATE')
  .limit(10)
  .convert('table', 'json')
  .output('dropbox', 'fxtest103-dropbox', '/test_data')
  .save({ name: 'Move a file from Google Drive to Dropbox (with modifications)' })
  .run()</pre>
      <button class="mt3 border-box no-select pointer ttu b ba f6 ph3 pv2 br1 white bg-blue b--blue darken-10" id="btn-run-pipe-1">Run</button>
      </div>
      <div class="pa3" id="run-pipe-1"></div>
    </div>

    <div class="mv3">
      <div class="pa3 bg-near-white">
        <h4 class="mt0">Create a message in python and email it as an attachment</h4>
        <pre>Flexio.pipe()
  .execute("\
def flexio_handler(input, output):\n\
    writer = output.create(name='Hello')\n\
    if 'message' in input.env:\n\
        writer.write(input.env['message'])\n\
    else:\n\
        writer.write('Hello, World!')")
        .email('flexio@mailinator.com', 'Flex.io JS SDK Test - ' + (new Date()).toString(), 'This is a test...', null, 'attachment')
  .save({ name: 'Create a message in python and email it as an attachment' })
  .run()</pre>
      <button class="mt3 border-box no-select pointer ttu b ba f6 ph3 pv2 br1 white bg-blue b--blue darken-10" id="btn-run-pipe-2">Run</button>
      </div>
      <div class="pa3" id="run-pipe-2"></div>
    </div>

  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="../dist/flexio.min.js"></script>
  <script>
    var $app = $('#app')

    Flexio.setup('crhxftrjzjdjcbfvdcqg')

    $app.find('h1').text('Flex.io Javascript SDK Version: ' + Flexio.version())

    function listConnectionsConsole() {
      var $div = $('#connections-console')
      $div.empty().append('Loading...')

      var connections = Flexio.connections().load(function() {
        $div.empty()
        $div.append('<h4 class="mt0">Output</h4>')
        $div.append('<pre>' + connections.list({ format: 'list', keys: ['eid', 'ename', 'name', 'description'] }) + '</pre>')
      }, function() {
        $div.append('<h4 class="mt0">Output</h4>')
        $div.append('<pre>There was an error requesting the connection list</pre>')
      })
    }

    function listConnectionsJson() {
      var $div = $('#connections-json')
      $div.empty().append('Loading...')

      var connections = Flexio.connections().load(function() {
        $div.empty()
        $div.append('<h4 class="mt0">Output</h4>')
        $div.append('<pre>' + connections.list({ keys: ['eid', 'ename', 'name', 'description'] }) + '</pre>')
      }, function() {
        $div.append('<h4 class="mt0">Output</h4>')
        $div.append('<pre>There was an error requesting the connection list</pre>')
      })
    }

    function listPipesConsole() {
      var $div = $('#pipes-console')
      $div.empty().append('Loading...')

      var pipes = Flexio.pipes().load(function() {
        $div.empty()
        $div.append('<h4 class="mt0">Output</h4>')
        $div.append('<pre>' + pipes.list({ format: 'list', keys: ['eid', 'ename', 'name', 'description'] }) + '</pre>')
      }, function() {
        $div.append('<h4 class="mt0">Output</h4>')
        $div.append('<pre>There was an error requesting the pipe list</pre>')
      })
    }

    function listPipesJson() {
      var $div = $('#pipes-json')
      $div.empty().append('Loading...')

      var pipes = Flexio.pipes().load(function() {
        $div.empty()
        $div.append('<h4 class="mt0">Output</h4>')
        $div.append('<pre>' + pipes.list({ keys: ['eid', 'ename', 'name', 'description'] }) + '</pre>')
      }, function() {
        $div.append('<h4 class="mt0">Output</h4>')
        $div.append('<pre>There was an error requesting the pipe list</pre>')
      })
    }

    $('#btn-list-connections-console').click(function() {
      listConnectionsConsole()
    })

    $('#btn-list-connections-json').click(function() {
      listConnectionsJson()
    })

    $('#btn-list-pipes-console').click(function() {
      listPipesConsole()
    })

    $('#btn-list-pipes-json').click(function() {
      listPipesJson()
    })

    $('#btn-run-pipe-1').click(function() {
      var $div = $('#run-pipe-1')
      $div.empty().append('Loading...')

      var pipe = Flexio.pipe()
        .input('googledrive', 'fxtest103-google-drive', ['/test_data/data_payment.csv'])
        .convert('delimited', 'table')
        .select('VEND_NAME', 'DUE_DATE')
        .limit(10)
        .convert('table', 'json')
        .output('dropbox', 'fxtest103-dropbox', '/test_data')
        .save({ name: 'Move a file from Google Drive to Dropbox (with modifications)' })
        .run(function() {
          $div.empty()
          $div.append('<h4 class="mt0">Output</h4>')
          $div.append('<pre>' + JSON.stringify(pipe.getLastProcess(), null, 2) + '</pre>')
        }, function() {
          $div.append('<h4 class="mt0">Output</h4>')
          $div.append('<pre>There was an error running the pipe</pre>')
        })
    })

    $('#btn-run-pipe-2').click(function() {
      var $div = $('#run-pipe-2')
      $div.empty().append('Loading...')

      var pipe = Flexio.pipe()
        .execute("\
def flexio_handler(input, output):\n\
    writer = output.create(name='Hello')\n\
    if 'message' in input.env:\n\
        writer.write(input.env['message'])\n\
    else:\n\
        writer.write('Hello, World!')")
        .email('flexio@mailinator.com', 'Flex.io JS SDK Test - ' + (new Date()).toString(), 'This is a test...', null, 'attachment')
        .save({ name: 'Create a message in python and email it as an attachment' })
        .run(function() {
            $div.empty()
            $div.append('<h4 class="mt0">Instructions</h4>')
            $div.append('<p>Visit <a href="https://www.mailinator.com/v2/inbox.jsp?zone=public&query=flexio" target="_blank">Mailinator</a> to see the email that was sent.</p>')
            $div.append('<h4 class="mt0">Output</h4>')
            $div.append('<pre>' + JSON.stringify(pipe.getLastProcess(), null, 2) + '</pre>')
          }, function() {
            $div.append('<h4 class="mt0">Output</h4>')
            $div.append('<pre>There was an error running the pipe</pre>')
          })
    })

/*
    var pipe = Flexio.pipe()
      .execute("\
def flexio_handler(input, output):\n\
    writer = output.create(name='Hello')\n\
    if 'message' in input.env:\n\
        writer.write(input.env['message'])\n\
    else:\n\
        writer.write('Hello, World!')")
      .email('dave@flex.io', 'Flex.io JS SDK Test', 'This is a test...', null, 'attachment')
      .run()

    $app.append('<pre>' + JSON.stringify(pipe.getJSON(), null, 2) + '</pre>')

    var pipe = Flexio.pipe()
      .execute("\
def flexio_handler(input, output):\n\
    writer = output.create(name='Hello')\n\
    if 'message' in input.env:\n\
        writer.write(input.env['message'])\n\
    else:\n\
        writer.write('Hello, World!')")
      .email('dzwillia@gmail.com', 'Flex.io JS SDK Test', 'This is a test...', null, 'attachment')

    var pipe = Flexio.pipe()
      .execute('https://raw.githubusercontent.com/flexiodata/examples/master/functions/hello-world.py')
      .save()
      .run()

    pipe.save({}, function() {
      $app.append('<h2>Pipe Content</h2>')
      $app.append('<pre>' + JSON.stringify(pipe.getJSON(), null, 2) + '</pre>')
    })
    .run(function() {
      $app.append('<h2>Process Content</h2>')
      $app.append('<pre>' + JSON.stringify(pipe.getLastProcess(), null, 2) + '</pre>')
    })

    var pipe = Flexio.pipe()
      .load('my-pipe-alias', function() {
        $app.append('<h2>Pipe Content</h2>')
        $app.append('<pre>' + JSON.stringify(pipe.getJSON(), null, 2) + '</pre>')
      })
      .run(function() {
        $app.append('<h2>Process Content</h2>')
        $app.append('<pre>' + JSON.stringify(pipe.getLastProcess(), null, 2) + '</pre>')
      })
*/
  </script>
</body>
</html>
