<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Flex.io Javascript SDK Test</title>
</head>

<body>
  <div id="app"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="../dist/flexio.min.js"></script>
  <script>
    Flexio.setup('gnffbxwtrrqfkvxdmrjs')

    var idx = 1;

    var $app = $('#app')
    $app.append('<h1>Flex.io Javascript SDK Version: ' + Flexio.version() + '</h1>')

    var pipe = Flexio.pipe()
      .execute("\
def flexio_handler(input, output):\n\
    writer = output.create(name='Hello')\n\
    if 'message' in input.env:\n\
        writer.write(input.env['message'])\n\
    else:\n\
        writer.write('Hello, World!')")
      .email('dave@flex.io', 'Flex.io JS SDK Test', 'This is a test...', null, 'attachment')
      .run()

    $app.append('<pre>' + JSON.stringify(pipe.getJson(), null, 2) + '</pre>')

/*
    var pipe = Flexio.pipe()
      .input('googledrive', 'dave-google-drive', ['/test_data/data_payment.csv'])
      .convert('delimited', 'table')
      .select('VEND_NAME', 'DUE_DATE')
      .limit(10)
      .convert('table', 'json')
      .output('dropbox', 'dave-dropbox', '/test_data')

    var pipe = Flexio.pipe()
      .execute('https://raw.githubusercontent.com/flexiodata/examples/master/functions/hello-world.py')

    var pipe = Flexio.pipe()
      .execute("\
def flexio_handler(input, output):\n\
    writer = output.create(name='Hello')\n\
    if 'message' in input.env:\n\
        writer.write(input.env['message'])\n\
    else:\n\
        writer.write('Hello, World!')")
      .email('dzwillia@gmail.com', 'Flex.io JS SDK Test', 'This is a test...', null, 'attachment')

    pipe.save({
      name: 'Test Pipe ' + (idx++)
    }, function() {
      $app.append('<h3>Pipe Content</h3>')
      $app.append('<pre>' + JSON.stringify(pipe.getJson(), null, 2) + '</pre>')
    })
    .run(function() {
      $app.append('<h3>Process Content</h3>')
      $app.append('<pre>' + JSON.stringify(pipe.getLastProcess(), null, 2) + '</pre>')
    })

    var pipe = Flexio.pipe()
      .load('my-pipe-alias', function() {
        $app.append('<h3>Pipe Content</h3>')
        $app.append('<pre>' + JSON.stringify(pipe.getJson(), null, 2) + '</pre>')
      })
      .run(function() {
        $app.append('<h3>Process Content</h3>')
        $app.append('<pre>' + JSON.stringify(pipe.getLastProcess(), null, 2) + '</pre>')
      })
*/
  </script>
</body>
</html>
